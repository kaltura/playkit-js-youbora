!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("playkit-js")):"function"==typeof define&&define.amd?define(["playkit-js"],t):"object"==typeof exports?exports.youbora=t(require("playkit-js")):(e.KalturaPlayer=e.KalturaPlayer||{},e.KalturaPlayer.plugins=e.KalturaPlayer.plugins||{},e.KalturaPlayer.plugins.youbora=t(e.KalturaPlayer.core))}(this,function(e){return function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(t,r){t.exports=e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NAME=t.VERSION=void 0;var i=r(0),n=r(2),s=function(e){return e&&e.__esModule?e:{default:e}}(n);t.default=s.default,t.VERSION="0.4.2",t.NAME="playkit-js-youbora";(0,i.registerPlugin)("youbora",s.default)},function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,r,i)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(i)},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=r(0),d=r(3),h=function(e){return e&&e.__esModule?e:{default:e}}(d),p=function(e){function t(e,r,s){i(this,t);var a=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,s));return a._youbora=new h.default(a.player,a.config),a._addBindings(),a._setup(),a}return s(t,e),o(t,null,[{key:"isValid",value:function(){return!0}}]),o(t,[{key:"updateConfig",value:function(e){a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateConfig",this).call(this,e),this._youbora.setOptions(e.options),this._addPlayerMetadata()}},{key:"reset",value:function(){this._youbora&&this._youbora.reset()}},{key:"_addPlayerMetadata",value:function(){this._youbora.setOptions({properties:{kalturaInfo:{entryId:this.config.entryId,sessionId:this.config.sessionId,uiConfId:this.config.uiConfId}}})}},{key:"_addBindings",value:function(){h.default.bindLogger(this.logger)}},{key:"_setup",value:function(){this._youbora.registerListeners()}},{key:"destroy",value:function(){this._youbora&&this._youbora.endedHandler()}}]),t}(u.BasePlugin);p.defaultConfig={options:{haltOnError:!1}},t.default=p},function(e,t,r){"use strict";var i=r(4),n=function(e){return e&&e.__esModule?e:{default:e}}(i),s=r(5),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(s),o=r(0);n.default.plugins.KalturaV3=function(e,t){try{this.config=t,this.pluginName=this.config.playerName,this.pluginVersion=n.default.version+"-"+a.version+"-"+this.pluginName,this.startMonitoring(e,this.config.options)}catch(e){n.default.error(e)}},/**
 * @license
 * Youbora Plugin JS Kaltura player
 * Copyright NicePopleAtWork & Kaltura
 * @author Jordi Aguilar & Dan Ziv
 */
n.default.plugins.KalturaV3.prototype=new n.default.plugins.Generic,n.default.plugins.KalturaV3.bindLogger=function(e){n.default.error=e.error.bind(e),n.default.notice=e.info.bind(e),n.default.noticeRequest=e.info.bind(e),n.default.warn=e.warn.bind(e),n.default.debug=e.debug.bind(e),n.default.verbose=function(){}},n.default.plugins.KalturaV3.prototype.reset=function(){this.endedHandler(),this.viewManager.comm.view++},n.default.plugins.KalturaV3.prototype.getPlayhead=function(){return this.player.currentTime},n.default.plugins.KalturaV3.prototype.getMediaDuration=function(){return this.player.duration},n.default.plugins.KalturaV3.prototype.getResource=function(){return this.player.src},n.default.plugins.KalturaV3.prototype.getPlayerVersion=function(){return this.config.playerName+"-"+this.config.playerVersion},n.default.plugins.KalturaV3.prototype.getBitrate=function(){var e=this.player.getActiveTracks().video;return e&&e.bandwidth?e.bandwidth:-1},n.default.plugins.KalturaV3.prototype.getTitle=function(){return this.config.entryName},n.default.plugins.KalturaV3.prototype.getRendition=function(){var e=this.player.getActiveTracks().video;if(e)return n.default.utils.buildRenditionString(e.width,e.height,e.bandwidth)},n.default.plugins.KalturaV3.prototype.getIsLive=function(){return"Live"===this.config.entryType},n.default.plugins.KalturaV3.prototype.registerListeners=function(){var e=this,t=this.player.Event,r=this.player.State;this.player.addEventListener(t.PLAY,function(){e.playHandler()}),this.player.addEventListener(t.ENDED,function(){e.endedHandler()}),this.player.addEventListener(t.PLAYING,function(){e.playingHandler()}),this.player.addEventListener(t.PAUSE,function(){e.pauseHandler()}),this.player.addEventListener(t.ERROR,function(t){t.payload.severity===o.Error.Severity.CRITICAL&&(e.errorHandler(t.payload.code,t.payload.data),e.endedHandler())}),this.player.addEventListener(t.SEEKING,function(){e.viewManager.isBuffering||e.seekingHandler()}),this.player.addEventListener(t.SEEKED,function(){e.seekedHandler()}),this.player.addEventListener(t.PLAYER_STATE_CHANGED,function(t){var i=t.payload.newState.type,n=t.payload.oldState.type;i===r.BUFFERING&&e.bufferingHandler(),n===r.BUFFERING&&e.bufferedHandler()})},e.exports=n.default.plugins.KalturaV3},function(e,t,r){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=n||{version:"5.4.6",plugins:{},adnalyzers:{},utils:{},managers:{},comm:{},data:{}};n.comm.Communication=function(e,t){try{this.host=e,this.httpSecure=t,this.pingTime=5,this.prefix="U",this.code="",this.view=-1,this.preloaders=[],this._requests={},this.addPreloader("FastData")}catch(e){n.error(e)}},n.comm.Communication.prototype.extraOperationsCallback=null,n.comm.Communication.prototype.getViewCode=function(){return this.code?this.prefix+this.code+"_"+this.view:"nocode"},n.comm.Communication.prototype.nextView=function(e){return this.view++,this.prefix=!0===e?"L":!1===e?"V":"U",this.getViewCode()},n.comm.Communication.prototype.requestData=function(e,t){try{e=e||{},e.outputformat="jsonp",delete e.code;var r=this,i=new n.comm.AjaxRequest(this._parseServiceHost(this.host),"/data",e);i.load(function(){r.receiveData(i)}),i.load(t),i.send(),n.noticeRequest("Request: NQS /data "+e.system)}catch(e){n.error(e)}},n.comm.Communication.prototype.receiveData=function(e){try{var t=e.getXHR(),r=t.response||t.responseText,i=JSON.parse(r.slice(r.indexOf("(")+1,r.lastIndexOf(")"))),s=i.q.h,a=i.q.c,o=i.q.pt,u=i.q.b;s.length>0&&a.length>0&&o.length>0&&u.length>0?(this.prefix=a.slice(0,1),this.code=a.slice(1),this.host=s,this.pingTime=o,this.balancerEnabled=u,n.noticeRequest("FastData '"+a+"' is ready."),this._requests.nocode&&this._requests.nocode.length>0&&(this._requests[this.getViewCode()]=this._requests.nocode,delete this._requests.nocode),this.removePreloader("FastData")):n.error("Error: FastData response is wrong.")}catch(e){n.error(e)}},n.comm.Communication.prototype.sendRequest=function(e,t,r){try{t=t||{},delete t.code;var i=new n.comm.AjaxRequest("",e,t);i.load(r),this._registerRequest(i)}catch(e){n.error(e)}},n.comm.Communication.prototype.sendService=function(e,t,r){try{var i=new n.comm.AjaxRequest(this._parseServiceHost(e),"",t);i.load(r),this._registerRequest(i)}catch(e){n.error(e)}},n.comm.Communication.prototype.addPreloader=function(e){try{this.preloaders.push(e)}catch(e){n.error(e)}},n.comm.Communication.prototype.removePreloader=function(e){try{var t=this.preloaders.indexOf(e);if(-1!==t){if(this.preloaders.splice(t,1),0===this.preloaders.length){var r;for(var i in this._requests)for(;r=this._requests[i].shift();)r.setParam("code",i),r.host||(r.host=this._parseServiceHost(this.host)),"function"==typeof this.extraOperationsCallback&&this.extraOperationsCallback(r.params),r.send()}}else n.warn("Warning: trying to remove unexisting preloader '"+e+"'.")}catch(e){n.error(e)}},n.comm.Communication.prototype._registerRequest=function(e){try{return void 0===this._requests[this.getViewCode()]&&(this._requests[this.getViewCode()]=[]),e.setParam("timemark",(new Date).getTime()),this._requests[this.getViewCode()].push(e),this._sendRequests(),e}catch(e){n.error(e)}},n.comm.Communication.prototype._sendRequests=function(){try{if(0===this.preloaders.length){var e;for(var t in this._requests)for(;e=this._requests[t].shift();)e.setParam("code",t),e.host||(e.host=this._parseServiceHost(this.host)),e.send()}}catch(e){n.error(e)}},n.comm.Communication.prototype._parseServiceHost=function(e){try{return 0===e.indexOf("//")?e=e.slice(2):0===e.indexOf("http://")?e=e.slice(7):0===e.indexOf("https://")&&(e=e.slice(8)),e=!0===this.httpSecure?"https://"+e:0===window.location.protocol.indexOf("http")?"//"+e:"http://"+e}catch(e){return n.error(e),"http://localhost"}},n.comm.AjaxRequest=function(e,t,r,i){try{this.xhr=this.createXHR(),this.host=e,this.service=t||"",this.params=r,this.options=i||{},this.options.method=this.options.method||n.comm.AjaxRequest.options.method,this.options.maxRetries=this.options.maxRetries||n.comm.AjaxRequest.options.maxRetries,void 0===this.options.retryAfter&&(this.options.retryAfter=n.comm.AjaxRequest.options.retryAfter),this.hasError=!1,this.retries=1}catch(e){n.error(e)}},n.comm.AjaxRequest.onEverySuccess=null,n.comm.AjaxRequest.options={method:"GET",requestHeaders:{},maxRetries:3,retryAfter:5e3},n.comm.AjaxRequest.prototype.getUrl=function(){try{return this.host+this.service+this.getParams()}catch(e){n.error(e)}},n.comm.AjaxRequest.prototype.getParams=function(){try{switch(i(this.params)){case"object":return"?"+this._parseParams(this.params);case"string":return this.params?"?"+this.params:"";default:return""}}catch(e){n.error(e)}},n.comm.AjaxRequest.prototype.setParam=function(e,t){try{switch(i(this.params)){case"string":this.params.length>0&&(this.params+="&"),this.params+=e+"="+t;break;case"object":default:this.params[e]=t}return this}catch(e){return n.error(e),this}},n.comm.AjaxRequest.prototype.on=function(e,t){try{"error"==e&&(this.hasError=!0),"function"==typeof t?this.xhr.addEventListener(e,t,!1):void 0!==t&&n.warn("Warning: Request '"+this.getUrl()+"' has a callback that is not a function.")}catch(e){n.error(e)}finally{return this}},n.comm.AjaxRequest.prototype.load=function(e){return this.on("load",e)},n.comm.AjaxRequest.prototype.error=function(e){return this.on("error",e)},n.comm.AjaxRequest.prototype.send=function(){try{if(this.xhr.open(this.options.method,this.getUrl(),!0),this.options.requestHeaders)for(var e in this.options.requestHeaders)this.options.requestHeaders.hasOwnProperty(e)&&this.xhr.setRequestHeader(e,this.options.requestHeaders[e]);if(!this.hasError&&this.options.retryAfter>0&&this.options.maxRetries>0){var t=this;this.error(function(){if(t.retries>t.options.maxRetries)n.error("Error: Aborting failed request. Max retries reached.");else{n.warn("Error: Request "+t.service+" failed. Retry "+t.retries+" of "+t.options.maxRetries+" in "+t.options.retryAfter+"ms.");var e=t;setTimeout(function(){e.retries+=1,e.send()},t.options.retryAfter)}})}n.debugLevel>=5&&n.verbose("XHR Req: "+this.getUrl()),"function"==typeof n.comm.AjaxRequest.onEverySuccess&&this.load(n.comm.AjaxRequest.onEverySuccess),this.xhr.send()}catch(e){n.error(e)}},n.comm.AjaxRequest.prototype.createXHR=function(){try{return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return n.error(e),{}}},n.comm.AjaxRequest.prototype.getXHR=function(){return this.xhr},n.comm.AjaxRequest.prototype._parseParams=function(e){try{if("string"==typeof e)return e;if(null!==e&&"object"==(void 0===e?"undefined":i(e))){var t="";for(var r in e)null!==e[r]&&"object"==i(e[r])?t+=encodeURIComponent(r)+"="+encodeURIComponent(JSON.stringify(e[r]))+"&":null!==e[r]&&void 0!==e[r]&&""!==e[r]&&(t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r])+"&");return t.slice(0,-1)}return""}catch(e){return n.error(e),""}},n.data.Options=function(e){try{this.setOptions(e)}catch(e){n.error(e)}},n.data.Options.prototype={enableAnalytics:!0,disabledRequests:[],parseHLS:!1,parseCDNNodeHost:!1,useCDNFromParser:!1,parseCDNNameFrom:"x-cdn-forward",haltOnError:!0,hashTitle:!0,httpSecure:void 0,enableNiceBuffer:!0,enableNiceSeek:!0,accountCode:"nicetest",service:"nqs.nice264.com",username:void 0,transactionCode:void 0,network:{ip:void 0,isp:void 0},device:{id:void 0},media:{isLive:void 0,resource:void 0,title:void 0,duration:void 0,cdn:void 0,isBalanced:0,isResumed:0},ads:{expected:!1,resource:void 0,campaign:void 0,title:void 0,position:void 0,duration:void 0},properties:{contentId:void 0,type:void 0,transaction_type:void 0,genre:void 0,language:void 0,year:void 0,cast:void 0,director:void 0,owner:void 0,parental:void 0,price:void 0,rating:void 0,audioType:void 0,audioChannels:void 0,device:void 0,quality:void 0},extraParams:{param1:void 0,param2:void 0,param3:void 0,param4:void 0,param5:void 0,param6:void 0,param7:void 0,param8:void 0,param9:void 0,param10:void 0,param11:void 0,param12:void 0,param13:void 0,param14:void 0,param15:void 0,param16:void 0,param17:void 0,param18:void 0,param19:void 0,param20:void 0},setOptions:function(e,t){try{if(t=t||this,void 0!==e)for(var r in e)"object"==i(t[r])&&null!==t[r]?this.setOptions(e[r],t[r]):t[r]=e[r]}catch(e){n.error(e)}}},n.adnalyzers.Generic=function(){},n.adnalyzers.Generic.prototype={adnalyzerVersion:"5.3.0-GENERIC",ads:void 0,plugin:void 0},n.adnalyzers.Generic.prototype.startMonitoring=function(e,t){try{n.notice("Adnalyzer "+this.adnalyzerVersion+" is ready."),this.plugin=e,this.ads=t}catch(e){return n.error(e),null}},n.adnalyzers.Generic.prototype.stopMonitoring=function(){this.ads=null,this.plugin.viewManager.timer.adPlayheadMonitor.stop()},n.adnalyzers.Generic.prototype.enableAdBufferMonitor=function(){this.plugin.infoManager.options.enableNiceBuffer&&(this.plugin.viewManager.enableAdBufferMonitor=!0)},n.adnalyzers.Generic.prototype.enableAdSeekMonitor=function(){this.plugin.infoManager.options.enableNiceSeek&&(this.plugin.viewManager.enableAdSeekMonitor=!0)},n.adnalyzers.Generic.prototype.initAdHandler=function(){try{this.plugin.viewManager.isAdStartSent||this.plugin.viewManager.isAdInitSent||this.plugin.viewManager.sendAdInit()}catch(e){n.error(e)}},n.adnalyzers.Generic.prototype.playAdHandler=function(){try{this.plugin.viewManager.isAdStartSent||this.plugin.viewManager.sendAdStart()}catch(e){n.error(e)}},n.adnalyzers.Generic.prototype.startJoinAdHandler=function(){try{this.plugin.viewManager.isAdStartSent||(this.plugin.viewManager.sendAdStart(),this.plugin.viewManager.isBuffering&&(this.plugin.viewManager.chrono.joinTime.startTime=this.plugin.viewManager.chrono.buffer.startTime,this.plugin.viewManager.isBuffering=!1),this.plugin.viewManager.sendAdJoin())}catch(e){n.error(e)}},n.adnalyzers.Generic.prototype.joinAdHandler=function(){try{this.plugin.viewManager.sendAdJoin()}catch(e){n.error(e)}},n.adnalyzers.Generic.prototype.pauseAdHandler=function(){try{this.plugin.viewManager.sendAdPause()}catch(e){n.error(e)}},n.adnalyzers.Generic.prototype.pauseToggleAdHandler=function(){try{this.plugin.viewManager.isAdPaused?this.plugin.viewManager.sendAdResume():this.plugin.viewManager.sendAdPause()}catch(e){n.error(e)}},n.adnalyzers.Generic.prototype.resumeAdHandler=function(){try{this.plugin.viewManager.sendAdResume()}catch(e){n.error(e)}},n.adnalyzers.Generic.prototype.endedAdHandler=function(){try{this.plugin.viewManager.sendAdStop()}catch(e){n.error(e)}},n.adnalyzers.Generic.prototype.skipAdHandler=function(){try{this.plugin.viewManager.sendAdStop({skipped:!0})}catch(e){n.error(e)}},n.adnalyzers.Generic.prototype.bufferingAdHandler=function(){try{this.plugin.viewManager.sendAdBufferStart()}catch(e){n.error(e)}},n.adnalyzers.Generic.prototype.bufferedAdHandler=function(){try{this.plugin.viewManager.isAdStartSent&&(this.plugin.viewManager.isAdJoinSent?this.plugin.viewManager.isAdBuffering&&this.plugin.viewManager.sendAdBufferEnd():this.plugin.viewManager.sendAdJoin())}catch(e){n.error(e)}},n.adnalyzers.Generic.prototype.errorAdHandler=function(e,t){try{void 0===e&&(e=0),t=t||e||"Unknown error",this.plugin.viewManager.sendAdError({errorCode:e,msg:t})}catch(e){n.error(e)}},n.adnalyzers.Generic.prototype.noServedAdHandler=function(e,t){try{void 0===e&&(e=0),t=t||e||"Unknown error",this.plugin.viewManager.sendAdError({errorCode:e,msg:t,errorSeverity:"AdsNotServed"}),this.plugin.viewManager.sendAdStop()}catch(e){n.error(e)}},n.adnalyzers.Generic.prototype.clickAdHandler=function(e){try{this.plugin.viewManager.sendAdClick({adUrl:e})}catch(e){n.error(e)}},n.adnalyzers.Generic.prototype.getAdResource=function(){return"unknown"},n.adnalyzers.Generic.prototype.getMediaPlayhead=function(){return null},n.adnalyzers.Generic.prototype.getAdPlayhead=function(){return 0},n.adnalyzers.Generic.prototype.getAdPosition=function(){return this.plugin.viewManager.isJoinSent?"mid":"pre"},n.adnalyzers.Generic.prototype.getAdTitle=function(){return null},n.adnalyzers.Generic.prototype.getAdDuration=function(){return 0},n.adnalyzers.Generic.prototype.getAdBitrate=function(){return-1},n.adnalyzers.Generic.prototype.getAdPlayerVersion=function(){return null},n.plugins.Generic=function(){},n.plugins.Generic.prototype={pluginName:"GENERIC",pluginVersion:"5.1.0-GENERIC",playerId:"generic",player:null,tag:null,infoManager:void 0,viewManager:void 0,adnalyzer:null},n.plugins.Generic.prototype.startMonitoring=function(e,t){try{n.notice("Plugin "+this.pluginVersion+" (with YouboraJS "+n.version+") is ready."),"string"==typeof e?(this.playerId=e,this.player=document.getElementById(e)):(this.player=e,e&&e.id&&(this.playerId=e.id)),this.tag=this.player,void 0===this.infoManager?this.infoManager=new n.managers.Info(this,t):this.infoManager.setOptions(t),this.viewManager=new n.managers.View(this.infoManager)}catch(e){return n.error(e),null}},n.plugins.Generic.prototype.stopMonitoring=function(){this.player=null,this.tag=null,this.viewManager.stopTimers()},n.plugins.Generic.prototype.enableBufferMonitor=function(){this.infoManager.options.enableNiceBuffer&&(this.viewManager.enableBufferMonitor=!0)},n.plugins.Generic.prototype.enableSeekMonitor=function(){this.infoManager.options.enableNiceSeek&&(this.viewManager.enableSeekMonitor=!0)},n.plugins.Generic.prototype.setOptions=function(e){try{this.infoManager.options.setOptions(e)}catch(e){n.error(e)}},n.plugins.Generic.prototype.getOptions=function(){try{return this.infoManager.options||{}}catch(e){return n.error(e),{}}},n.plugins.Generic.prototype.playHandler=function(){try{this.viewManager.sendStart()}catch(e){n.error(e)}},n.plugins.Generic.prototype.joinHandler=function(){try{this.viewManager.sendJoin()}catch(e){n.error(e)}},n.plugins.Generic.prototype.playingHandler=function(){try{this.viewManager.isStartSent&&(this.viewManager.isJoinSent?this.viewManager.isSeeking&&this.viewManager.isPaused?(this.viewManager.sendSeekEnd(),this.viewManager.sendResume()):this.viewManager.isSeeking?this.viewManager.sendSeekEnd():this.viewManager.isBuffering?this.viewManager.sendBufferEnd():this.viewManager.isPaused&&this.viewManager.sendResume():this.viewManager.sendJoin())}catch(e){n.error(e)}},n.plugins.Generic.prototype.pauseHandler=function(){try{this.viewManager.sendPause()}catch(e){n.error(e)}},n.plugins.Generic.prototype.pauseToggleHandler=function(){try{this.viewManager.isPaused?this.viewManager.sendResume():this.viewManager.sendPause()}catch(e){n.error(e)}},n.plugins.Generic.prototype.resumeHandler=function(){try{this.viewManager.sendResume()}catch(e){n.error(e)}},n.plugins.Generic.prototype.endedHandler=function(){try{this.viewManager.sendStop()}catch(e){n.error(e)}},n.plugins.Generic.prototype.errorHandler=function(e,t){try{void 0===e&&(e=0),t=t||e||"Unknown error",this.viewManager.sendError({errorCode:e,msg:t})}catch(e){n.error(e)}},n.plugins.Generic.prototype.seekingHandler=function(){try{this.viewManager.isBuffering?this.viewManager.convertBufferToSeek():this.viewManager.sendSeekStart()}catch(e){n.error(e)}},n.plugins.Generic.prototype.seekedHandler=function(){try{this.viewManager.sendSeekEnd()}catch(e){n.error(e)}},n.plugins.Generic.prototype.bufferingHandler=function(){try{this.viewManager.isSeeking||this.viewManager.sendBufferStart()}catch(e){n.error(e)}},n.plugins.Generic.prototype.bufferedHandler=function(){try{this.viewManager.isStartSent&&(this.viewManager.isJoinSent?this.viewManager.isSeeking?this.viewManager.sendSeekEnd():this.viewManager.isBuffering&&this.viewManager.sendBufferEnd():this.viewManager.sendJoin())}catch(e){n.error(e)}},n.plugins.Generic.prototype.ignoringAdHandler=function(){try{this.viewManager.sendIgnoreAdStart()}catch(e){n.error(e)}},n.plugins.Generic.prototype.ignoredAdHandler=function(){try{this.viewManager.sendIgnoreAdEnd()}catch(e){n.error(e)}},n.plugins.Generic.prototype.getResource=function(){return"unknown"},n.plugins.Generic.prototype.getPlayhead=function(){return 0},n.plugins.Generic.prototype.getMediaDuration=function(){return 0},n.plugins.Generic.prototype.getIsLive=function(){return!1},n.plugins.Generic.prototype.getRendition=function(){return null},n.plugins.Generic.prototype.getBitrate=function(){return-1},n.plugins.Generic.prototype.getThroughput=function(){return-1},n.plugins.Generic.prototype.getPlayerVersion=function(){return null},n.plugins.Generic.prototype.getTotalBytes=function(){return null},n.plugins.Generic.prototype.getTitle=function(){return null},n.managers.Info=function(e,t){this.plugin=e,this.options=new n.data.Options(t),this.lastBitrate=0,this.lastAdBitrate=0},n.managers.Info.prototype.getDataParams=function(e){try{return e=e||{},e.system=e.hasOwnProperty("system")?e.system:this.options.accountCode,e.pluginName=e.hasOwnProperty("pluginName")?e.pluginName:this.plugin.pluginName,e.pluginVersion=e.hasOwnProperty("pluginVersion")?e.pluginVersion:this.plugin.pluginVersion,e.live=e.hasOwnProperty("live")?e.live:this.options.media.isLive,e}catch(t){return n.error(t),e}},n.managers.Info.prototype.setOptions=function(e){this.options.setOptions(e)},n.managers.Info.prototype.getOptions=function(e){return this.options},n.managers.Info.prototype.getAdPlayhead=function(){try{return this.plugin.adnalyzer?n.utils.parseNumber(this.plugin.adnalyzer.getAdPlayhead(),0):0}catch(e){return n.warn(e),0}},n.managers.Info.prototype.getAdBitrate=function(){try{if(this.plugin.adnalyzer){var e=Math.round(this.plugin.adnalyzer.getAdBitrate());if(-1==e&&this.plugin.adnalyzer.tag&&void 0!==this.plugin.adnalyzer.tag.webkitVideoDecodedByteCount){var t=this.plugin.adnalyzer.tag.webkitVideoDecodedByteCount;this.lastAdBitrate&&(t=Math.round((this.plugin.adnalyzer.tag.webkitVideoDecodedByteCount-this.lastAdBitrate)/5*8)),this.lastAdBitrate=this.plugin.adnalyzer.tag.webkitVideoDecodedByteCount,e=t}return n.utils.parseNumber(e,-1)}return-1}catch(e){return n.warn(e),-1}},n.managers.Info.prototype.getAdResource=function(){try{return void 0!==this.options.ads.resource?this.options.ads.resource:this.plugin.adnalyzer.getAdResource()}catch(e){return n.warn(e),""}},n.managers.Info.prototype.getAdPosition=function(){try{return void 0!==this.options.ads.position?this.options.ads.position:this.plugin.adnalyzer.getAdPosition()}catch(e){return n.warn(e),"mid"}},n.managers.Info.prototype.getAdTitle=function(){try{return void 0!==this.options.ads.title?this.options.ads.title:this.plugin.adnalyzer.getAdTitle()}catch(e){return n.warn(e),""}},n.managers.Info.prototype.getAdDuration=function(){try{var e=0;return e=void 0!==this.options.ads.duration?this.options.ads.duration:Math.round(this.plugin.adnalyzer.getAdDuration()),n.utils.parseNumber(e,0)}catch(e){return n.warn(e),0}},n.managers.Info.prototype.getAdPlayerVersion=function(){try{return this.plugin.adnalyzer.getAdPlayerVersion()}catch(e){return n.warn(e),null}},n.managers.Info.prototype.getAdStartParams=function(e,t){try{return e=e||{},e.position=void 0!==e.position?e.position:this.getAdPosition(),e.resource=void 0!==e.resource?e.resource:this.getAdResource(),e.campaign=void 0!==e.campaign?e.campaign:this.options.ads.campaign,e.title=void 0!==e.title?e.title:this.getAdTitle(),e.adDuration=void 0!==e.adDuration?e.adDuration:this.getAdDuration(),e.playhead=void 0!==e.playhead?e.playhead:Math.round(this.getPlayhead()),e.adnalyzerVersion=void 0!==e.adnalyzerVersion?e.adnalyzerVersion:this.plugin.adnalyzer.adnalyzerVersion,e.adPlayerVersion=void 0!==e.adPlayerVersion?e.adPlayerVersion:this.getAdPlayerVersion(),e}catch(t){return n.error(t),e}},n.managers.Info.prototype.getAdJoinParams=function(e,t){try{return e=e||{},e.adPlayhead=void 0!==e.adPlayhead?e.adPlayhead:this.getAdPlayhead(),e}catch(t){return n.error(t),e}},n.managers.Info.prototype.getAdStopParams=function(e,t){try{return e=e||{},e.adPlayhead=void 0!==e.adPlayhead?e.adPlayhead:Math.round(this.getAdPlayhead()),e.adBitrate=void 0!==e.adBitrate?e.adBitrate:this.getAdBitrate(),e}catch(t){return n.error(t),e}},n.managers.Info.prototype.getAdPauseParams=function(e,t){return e||{}},n.managers.Info.prototype.getAdResumeParams=function(e,t){return e||{}},n.managers.Info.prototype.getAdBufferEndParams=function(e,t){try{return e=e||{},e.adPlayhead=void 0!==e.adPlayhead?e.adPlayhead:Math.round(this.getAdPlayhead()),e}catch(t){return n.error(t),e}},n.managers.Info.prototype.getAdPingParams=function(e,t){try{return e=e||{},e.adBitrate=void 0!==e.adBitrate?e.adBitrate:this.getAdBitrate(),e.adPlayhead=void 0!==e.adPlayhead?e.adPlayhead:Math.round(this.getAdPlayhead()),e}catch(t){return n.error(t),e}},n.managers.Info.prototype.getAdErrorParams=function(e,t){try{return e=e||{},e.errorCode=e.hasOwnProperty("errorCode")?e.errorCode:"9000",e.msg=e.hasOwnProperty("msg")?e.msg:"Unknown Error",e.adPlayhead=void 0!==e.adPlayhead?e.adPlayhead:Math.round(this.getAdPlayhead()),e.player=e.hasOwnProperty("player")?e.player:this.plugin.pluginName,e}catch(t){return n.error(t),e}},n.managers.Info.prototype.getAdClickParams=function(e,t){try{return e=e||{},e.adPlayhead=void 0!==e.adPlayhead?e.adPlayhead:Math.round(this.getAdPlayhead()),e}catch(t){return n.error(t),e}},n.managers.Info.prototype.getResource=function(){try{return this.plugin.viewManager.resourceParser&&this.plugin.viewManager.resourceParser.realResource?this.plugin.viewManager.resourceParser.realResource:void 0!==this.options.media.resource?this.options.media.resource:this.plugin.getResource()}catch(e){return n.warn(e),"unknown"}},n.managers.Info.prototype.getCDN=function(){try{return this.plugin.viewManager.resourceParser&&this.plugin.viewManager.resourceParser.cdn&&this.options.useCDNFromParser?this.plugin.viewManager.resourceParser.cdn:void 0!==this.options.media.cdn?this.options.media.cdn:null}catch(e){return n.warn(e),null}},n.managers.Info.prototype.getMediaDuration=function(){try{var e=0;return e=void 0!==this.options.media.duration?this.options.media.duration:this.plugin.getMediaDuration(),Math.round(n.utils.parseNumber(e,0))}catch(e){return n.warn(e),0}},n.managers.Info.prototype.getIsLive=function(){try{return void 0!==this.options.media.isLive?this.options.media.isLive:this.plugin.getIsLive()}catch(e){return n.warn(e),!1}},n.managers.Info.prototype.getPlayerVersion=function(){try{return this.plugin.getPlayerVersion()}catch(e){return n.warn(e),""}},n.managers.Info.prototype.getTitle=function(){try{return void 0!==this.options.media.title?this.options.media.title:this.plugin.getTitle()}catch(e){return n.warn(e),""}},n.managers.Info.prototype.getRendition=function(){try{return void 0!==this.options.media.rendition?this.options.media.rendition:this.plugin.getRendition()}catch(e){return n.warn(e),""}},n.managers.Info.prototype.getBitrate=function(){try{var e=Math.round(this.plugin.getBitrate());if(-1==e&&this.plugin.tag&&void 0!==this.plugin.tag.webkitVideoDecodedByteCount){var t=this.plugin.tag.webkitVideoDecodedByteCount;this.lastBitrate&&(t=Math.round((this.plugin.tag.webkitVideoDecodedByteCount-this.lastBitrate)/5*8)),this.lastBitrate=this.plugin.tag.webkitVideoDecodedByteCount,e=0!=t?t:-1}return n.utils.parseNumber(e,-1)}catch(e){return n.warn(e),-1}},n.managers.Info.prototype.getThroughput=function(){try{return n.utils.parseNumber(Math.round(this.plugin.getThroughput()),-1)}catch(e){return n.warn(e),-1}},n.managers.Info.prototype.getTotalBytes=function(){try{return n.utils.parseNumber(this.plugin.getTotalBytes(),null)}catch(e){return n.warn(e),null}},n.managers.Info.prototype.getPlayhead=function(){try{var e=this.plugin.getPlayhead();return this.plugin.adnalyzer&&null!==this.plugin.adnalyzer.getMediaPlayhead()&&(e=this.plugin.adnalyzer.getMediaPlayhead()),n.utils.parseNumber(e,0)}catch(e){return n.warn(e),0}},n.managers.Info.prototype.getStartParams=function(e){try{if(e=e||{},e.system=e.hasOwnProperty("system")?e.system:this.options.accountCode,e.player=e.hasOwnProperty("player")?e.player:this.plugin.pluginName,e.user=e.hasOwnProperty("user")?e.user:this.options.username,e.transcode=e.hasOwnProperty("transcode")?e.transcode:this.options.transactionCode,e.hashTitle=e.hasOwnProperty("hashTitle")?e.hashTitle:this.options.hashTitle,!e.hasOwnProperty("referer")){e.referer="";try{e.referer=top.window.location.href}catch(t){e.referer=window.location.href}}return e.deviceId=e.hasOwnProperty("deviceId")?e.deviceid:this.options.device.id,e.pluginVersion=e.hasOwnProperty("pluginVersion")?e.pluginVersion:this.plugin.pluginVersion,e.playerVersion=e.hasOwnProperty("playerVersion")?e.playerVersion:this.getPlayerVersion(),e.resource=e.hasOwnProperty("resource")?e.resource:this.getResource(),e.duration=e.hasOwnProperty("duration")?e.duration:this.getMediaDuration(),e.live=e.hasOwnProperty("live")?e.live:this.getIsLive(),e.rendition=e.hasOwnProperty("rendition")?e.rendition:this.getRendition(),e.title=e.hasOwnProperty("title")?e.title:this.getTitle(),e.properties=e.hasOwnProperty("properties")?e.properties:this.options.properties,e.cdn=e.hasOwnProperty("cdn")?e.cdn:this.getCDN(),e.isp=e.hasOwnProperty("isp")?e.isp:this.options.network.isp,e.ip=e.hasOwnProperty("ip")?e.ip:this.options.network.ip,e.param1=e.hasOwnProperty("param1")?e.param1:this.options.extraParams.param1,e.param2=e.hasOwnProperty("param2")?e.param2:this.options.extraParams.param2,e.param3=e.hasOwnProperty("param3")?e.param3:this.options.extraParams.param3,e.param4=e.hasOwnProperty("param4")?e.param4:this.options.extraParams.param4,e.param5=e.hasOwnProperty("param5")?e.param5:this.options.extraParams.param5,e.param6=e.hasOwnProperty("param6")?e.param6:this.options.extraParams.param6,e.param7=e.hasOwnProperty("param7")?e.param7:this.options.extraParams.param7,e.param8=e.hasOwnProperty("param8")?e.param8:this.options.extraParams.param8,e.param9=e.hasOwnProperty("param9")?e.param9:this.options.extraParams.param9,e.param10=e.hasOwnProperty("param10")?e.param10:this.options.extraParams.param10,e.param11=e.hasOwnProperty("param11")?e.param11:this.options.extraParams.param11,e.param12=e.hasOwnProperty("param12")?e.param12:this.options.extraParams.param12,e.param13=e.hasOwnProperty("param13")?e.param13:this.options.extraParams.param13,e.param14=e.hasOwnProperty("param14")?e.param14:this.options.extraParams.param14,e.param15=e.hasOwnProperty("param15")?e.param15:this.options.extraParams.param15,e.param16=e.hasOwnProperty("param16")?e.param16:this.options.extraParams.param16,e.param17=e.hasOwnProperty("param17")?e.param17:this.options.extraParams.param17,e.param18=e.hasOwnProperty("param18")?e.param18:this.options.extraParams.param18,e.param19=e.hasOwnProperty("param19")?e.param19:this.options.extraParams.param19,e.param20=e.hasOwnProperty("param20")?e.param20:this.options.extraParams.param20,e.totalBytes=e.hasOwnProperty("totalBytes")?e.totalBytes:this.getTotalBytes(),e.adsExpected=e.hasOwnProperty("adsExpected")?e.adsExpected:this.options.ads.expected,1==this.options.isResumed&&(e.isResumed=1),1==this.options.isBalanced&&(e.isBalanced=1),e}catch(t){return n.error(t),e}},n.managers.Info.prototype.getJoinParams=function(e){try{return e=e||{},e.eventTime=e.hasOwnProperty("eventTime")?e.eventTime:this.getPlayhead(),e.mediaDuration=e.hasOwnProperty("mediaDuration")?e.mediaDuration:this.getMediaDuration(),e}catch(t){return n.error(t),e}},n.managers.Info.prototype.getStopParams=function(e){return e||{}},n.managers.Info.prototype.getPauseParams=function(e){return e||{}},n.managers.Info.prototype.getResumeParams=function(e){return e||{}},n.managers.Info.prototype.getBufferEndParams=function(e){try{return e=e||{},e.time=e.hasOwnProperty("time")?e.time:this.getPlayhead(),e}catch(t){return n.error(t),e}},n.managers.Info.prototype.getErrorParams=function(e){try{return e=e||{},e.errorCode=e.hasOwnProperty("errorCode")?e.errorCode:"9000",e.msg=e.hasOwnProperty("msg")?e.msg:"Unknown Error",e=this.getStartParams(e)}catch(t){return n.error(t),e}},n.managers.Info.prototype.getSeekEndParams=function(e){return this.getBufferEndParams(e)},n.managers.Info.prototype.getPingParams=function(e,t){try{return e=e||{},e.time=void 0!==e.time?e.time:this.getPlayhead(),e.bitrate=void 0!==e.bitrate?e.bitrate:this.getBitrate(),e.throughput=void 0!==e.throughput?e.throughput:this.getThroughput(),e.totalBytes=void 0!==e.totalBytes?e.totalBytes:this.getTotalBytes(),e}catch(t){return n.error(t),e}},n.managers.View=function(e){this.infoManager=e,this.isStartSent=!1,this.isJoinSent=!1,this.isPaused=!1,this.isSeeking=!1,this.isBuffering=!1,this.isErrorSent=!1,this.isShowingAds=!1,this.isAdStartSent=!1,this.isAdJoinSent=!1,this.isAdPaused=!1,this.isAdBuffering=!1,this.chrono={joinTime:new n.utils.Chrono,seek:new n.utils.Chrono,pause:new n.utils.Chrono,buffer:new n.utils.Chrono,adIgnore:new n.utils.Chrono,adTotal:new n.utils.Chrono,adJoinTime:new n.utils.Chrono,adPause:new n.utils.Chrono,adBuffer:new n.utils.Chrono},this.adCounter={pre:0,mid:0,post:0,unknown:0};var t=this;this.timer={pinger:new n.utils.Timer(function(e){t.sendPing({diffTime:e})}),playheadMonitor:new n.utils.Timer(function(e){t.checkPlayhead()},n.managers.View.monitoringInterval),adPlayheadMonitor:new n.utils.Timer(function(e){t.checkAdPlayhead()},n.managers.View.monitoringInterval)},this.enableBufferMonitor=!1,this.enableSeekMonitor=!1,this.enableAdBufferMonitor=!1,this.enableAdSeekMonitor=!1,this.lastDuration=0,this.lastPlayhead=0,this.lastAdPosition="",this.lastRendition="",this.lastResume=0,this.changedEntities=[],this.resourceParser=new n.utils.ResourceParser(this),this.comm=new n.comm.Communication(this.infoManager.options.service,this.infoManager.options.httpSecure),this.comm.requestData(this.infoManager.getDataParams(),function(){t.timer.pinger.interval=Math.max(1e3,1e3*t.comm.pingTime)})},n.managers.View.prototype.sendRequest=function(e,t,r){try{this.isAllowed(e)&&this.comm.sendRequest(e,t,r)}catch(e){n.error(e)}},n.managers.View.prototype.isAllowed=function(e){return this.infoManager.options.enableAnalytics&&!(e in this.infoManager.options.disabledRequests)},n.managers.View.prototype.isHalted=function(){return this.infoManager.options.haltOnError&&this.isErrorSent},n.managers.View.prototype.sendAdInit=function(e,t){try{this.isHalted()||this.isAdStartSent||this.isAdInitSent||(this.isShowingAds=!0,this.isAdInitSent=!0,this.chrono.adTotal.start(),this.chrono.adJoinTime.start(),this.sendSeekEnd(),this.sendBufferEnd(),e=this.infoManager.getAdStartParams(e),e.number=void 0!==e.number?e.number:this.getAdNumber(e.position,!0),this.lastAdPosition=e.position,this.sendRequest("/adInit",e,t),n.noticeRequest("Request: NQS /adInit "+e.position+e.number))}catch(e){n.error(e)}},n.managers.View.prototype.sendAdStart=function(e,t){try{this.isHalted()||this.isAdStartSent||(this.isShowingAds=!0,this.isAdStartSent=!0,this.isAdInitSent||(this.chrono.adTotal.start(),this.chrono.adJoinTime.start()),this.sendSeekEnd(),this.sendBufferEnd(),e=this.infoManager.getAdStartParams(e),e.number=void 0!==e.number?e.number:this.getAdNumber(e.position,!this.isAdInitSent),this.lastAdPosition=e.position,this.sendRequest("/adStart",e,t),n.noticeRequest("Request: NQS /adStart "+e.position+e.number),this.isAdInitSent&&(this.sendAdJoin(),this.isAdInitSent=!1))}catch(e){n.error(e)}},n.managers.View.prototype.sendAdJoin=function(e,t){try{this.isHalted()||this.isAdStartSent&&!this.isAdJoinSent&&(this.isAdJoinSent=!0,(this.enableAdBufferMonitor||this.enableAdSeekMonitor)&&(this.timer.adPlayheadMonitor.start(),this.lastPlayhead=0),e=this.infoManager.getAdJoinParams(e),e.duration=void 0!==e.duration?e.duration:this.chrono.adJoinTime.getDeltaTime(),e.position=void 0!==e.position?e.position:this.lastAdPosition,e.number=void 0!==e.number?e.number:this.getAdNumber(e.position),this.sendRequest("/adJoinTime",e,t),n.noticeRequest("Request: NQS /adJoinTime "+e.duration+"ms"))}catch(e){n.error(e)}},n.managers.View.prototype.sendAdStop=function(e,t){try{this.isHalted()||(this.isAdStartSent||this.isAdInitSent)&&(this.isAdStartSent=!1,this.isAdJoinSent=!1,this.isAdPaused=!1,this.isAdBuffering=!1,this.isShowingAds=!1,this.isAdInitSent=!1,this.timer.adPlayheadMonitor.stop(),e=this.infoManager.getAdStopParams(e),e.totalDuration=void 0!==e.totalDuration?e.totalDuration:this.chrono.adTotal.getDeltaTime(),e.position=void 0!==e.position?e.position:this.lastAdPosition,e.number=void 0!==e.number?e.number:this.getAdNumber(e.position),e.adPlayhead||delete e.adPlayhead,this.isJoinSent||(this.chrono.joinTime.startTime+=this.chrono.adTotal.getDeltaTime(),this.chrono.joinTime.startTime=Math.min(this.chrono.joinTime.startTime,(new Date).getTime())),this.sendRequest("/adStop",e,t),n.noticeRequest("Request: NQS /adStop "+e.totalDuration+"ms"))}catch(e){n.error(e)}},n.managers.View.prototype.sendAdPause=function(e,t){try{this.isHalted()||this.isAdJoinSent&&!this.isAdPaused&&(this.isAdPaused=!0,this.chrono.adPause.start(),e=this.infoManager.getAdPauseParams(e),e.position=void 0!==e.position?e.position:this.lastAdPosition,e.number=void 0!==e.number?e.number:this.getAdNumber(e.position),this.sendRequest("/adPause",e,t),n.noticeRequest("Request: NQS /adPause"))}catch(e){n.error(e)}},n.managers.View.prototype.sendAdResume=function(e,t){try{this.isHalted()||this.isAdJoinSent&&this.isAdPaused&&(this.isAdPaused=!1,this.chrono.adPause.stop(),e=this.infoManager.getAdResumeParams(e),e.position=void 0!==e.position?e.position:this.lastAdPosition,e.number=void 0!==e.number?e.number:this.getAdNumber(e.position),this.sendRequest("/adResume",e,t),n.noticeRequest("Request: NQS /adResume"))}catch(e){n.error(e)}},n.managers.View.prototype.sendAdBufferStart=function(){try{this.isHalted()||this.isAdJoinSent&&!this.isAdBuffering&&(this.isAdBuffering=!0,this.chrono.adBuffer.start(),n.noticeRequest("Method: /adBufferStart"))}catch(e){n.error(e)}},n.managers.View.prototype.sendAdBufferEnd=function(e,t){try{this.isHalted()||this.isAdJoinSent&&this.isAdBuffering&&(this.isAdBuffering=!1,e=this.infoManager.getAdBufferEndParams(e),e.duration=void 0!==e.duration?e.duration:this.chrono.adBuffer.getDeltaTime(),e.position=void 0!==e.position?e.position:this.lastAdPosition,e.number=void 0!==e.number?e.number:this.getAdNumber(e.position),this.sendRequest("/adBufferUnderrun",e,t),n.noticeRequest("Request: NQS /adBufferUnderrun "+e.duration+"ms"))}catch(e){n.error(e)}},n.managers.View.prototype.sendAdError=function(e,t){try{this.isHalted()||(e=this.infoManager.getAdErrorParams(e),void 0===e.position&&(this.isAdStartSent?e.position=this.lastAdPosition:e.position=this.infoManager.getAdPosition(),e.number=this.getAdNumber(e.position)),this.sendRequest("/adError",e,t),n.noticeRequest("Request: NQS /adError"))}catch(e){n.error(e)}},n.managers.View.prototype.sendAdClick=function(e,t){try{this.isHalted()||(e=this.infoManager.getAdClickParams(e),e.position=void 0!==e.position?e.position:this.lastAdPosition,e.number=void 0!==e.number?e.number:this.getAdNumber(e.position),this.sendRequest("/adClick",e,t),n.noticeRequest("Request: NQS /adClick"))}catch(e){n.error(e)}},n.managers.View.prototype.getAdNumber=function(e,t){var r=0;switch(e){case"pre":r=t?++this.adCounter.pre:this.adCounter.pre;break;case"mid":r=t?++this.adCounter.mid:this.adCounter.mid;break;case"post":r=t?++this.adCounter.post:this.adCounter.post;break;default:r=t?++this.adCounter.unknown:this.adCounter.unknown}return r>0?r:1},n.managers.View.prototype.resetAdNumbers=function(){this.adCounter={pre:0,mid:0,post:0,unknown:0}},n.managers.View.prototype.sendIgnoreAdStart=function(){try{this.isHalted()||this.isStartSent&&!this.isShowingAds&&(this.isShowingAds=!0,this.chrono.adIgnore.start(),this.sendBufferEnd(),this.sendSeekEnd(),n.noticeRequest("Method: /genericAdStart"))}catch(e){n.error(e)}},n.managers.View.prototype.sendIgnoreAdEnd=function(){try{this.isHalted()||this.isStartSent&&this.isShowingAds&&(this.isShowingAds=!1,this.chrono.adIgnore.stop(),this.isJoinSent||(this.chrono.joinTime.startTime+=this.chrono.adIgnore.getDeltaTime(),this.chrono.joinTime.startTime=Math.min(this.chrono.joinTime.startTime,(new Date).getTime())),n.noticeRequest("Method: /genericAdEnd "+this.chrono.adIgnore.getDeltaTime()+"ms"))}catch(e){n.error(e)}},n.managers.View.prototype.sendStart=function(e,t){try{this.isHalted()||this.isStartSent||((this.infoManager.options.parseCDNNodeHost||this.infoManager.options.parseHLS)&&this.resourceParser.init(),this.isStartSent=!0,this.chrono.joinTime.start(),n.noticeRequest("Sending pings every "+this.comm.pingTime+"s."),this.timer.pinger.interval=Math.max(1e3,1e3*this.comm.pingTime),this.timer.pinger.start(),e=this.infoManager.getStartParams(e),e.pingTime=void 0!==e.pingTime?e.pingTime:this.comm.pingTime,this.infoManager.options.parseCDNNodeHost&&(e.nodeHost=void 0!==e.nodeHost?e.nodeHost:void 0!==this.resourceParser.nodeHost?this.resourceParser.nodeHost:"",e.nodeType=void 0!==e.nodeType?e.nodeType:void 0!==this.resourceParser.nodeType?this.resourceParser.nodeType:""),this.comm.nextView(e.live),this.sendRequest("/start",e,t),n.noticeRequest("Request: NQS /start "+e.resource),this.lastDuration=e.duration,this.lastRendition=e.rendition)}catch(e){n.error(e)}},n.managers.View.prototype.sendJoin=function(e,t){try{this.isHalted()||!this.isStartSent||this.isJoinSent||this.isShowingAds||(this.isJoinSent=!0,(this.enableBufferMonitor||this.enableSeekMonitor)&&(this.timer.playheadMonitor.start(),this.lastPlayhead=0),e=this.infoManager.getJoinParams(e),e.time=void 0!==e.time?e.time:this.chrono.joinTime.getDeltaTime(),e.mediaDuration===this.lastDuration&&delete e.mediaDuration,this.sendRequest("/joinTime",e,t),n.noticeRequest("Request: NQS /joinTime "+e.time+"ms"))}catch(e){n.error(e)}},n.managers.View.prototype.sendStop=function(e,t){try{this.isHalted()||this.isStartSent&&(this.isStartSent=!1,this.isPaused=!1,this.isJoinSent=!1,this.isSeeking=!1,this.isBuffering=!1,this.isErrorSent=!1,this.resourceParser.clear(),this.resetAdNumbers(),this.stopTimers(),e=this.infoManager.getStopParams(e),e.diffTime=void 0!==e.diffTime?e.diffTime:this.timer.pinger.chrono.getDeltaTime(),this.sendRequest("/stop",e,t),n.noticeRequest("Request: NQS /stop"))}catch(e){n.error(e)}},n.managers.View.prototype.sendPause=function(e,t){try{this.isHalted()||this.isJoinSent&&!this.isPaused&&(this.isPaused=!0,this.chrono.pause.start(),e=this.infoManager.getPauseParams(e),this.sendRequest("/pause",e,t),n.noticeRequest("Request: NQS /pause"))}catch(e){n.error(e)}},n.managers.View.prototype.sendResume=function(e,t){try{this.isHalted()||this.isJoinSent&&this.isPaused&&(this.isPaused=!1,this.chrono.pause.stop(),this.lastResume=(new Date).getTime(),e=this.infoManager.getResumeParams(e),this.sendRequest("/resume",e,t),n.noticeRequest("Request: NQS /resume"))}catch(e){n.error(e)}},n.managers.View.prototype.sendBufferStart=function(){try{this.isHalted()||this.isJoinSent&&!this.isBuffering&&(this.isBuffering=!0,this.chrono.buffer.start(),n.noticeRequest("Method: /bufferStart"))}catch(e){n.error(e)}},n.managers.View.prototype.sendBufferEnd=function(e,t){try{this.isHalted()||this.isJoinSent&&this.isBuffering&&(this.isBuffering=!1,this.lastResume=(new Date).getTime(),e=this.infoManager.getBufferEndParams(e),e.duration=void 0!==e.duration?e.duration:this.chrono.buffer.getDeltaTime(),this.sendRequest("/bufferUnderrun",e,t),n.noticeRequest("Request: NQS /bufferUnderrun "+e.duration+"ms"))}catch(e){n.error(e)}},n.managers.View.prototype.sendSeekStart=function(){try{this.isHalted()||this.isJoinSent&&!this.isSeeking&&(this.isSeeking=!0,this.chrono.seek.start(),n.noticeRequest("Method: /seekStart"))}catch(e){n.error(e)}},n.managers.View.prototype.sendSeekEnd=function(e,t){try{this.isHalted()||this.isJoinSent&&this.isSeeking&&(this.isSeeking=!1,this.lastResume=(new Date).getTime(),e=this.infoManager.getSeekEndParams(e),e.duration=void 0!==e.duration?e.duration:this.chrono.seek.getDeltaTime(),this.sendRequest("/seek",e,t),n.noticeRequest("Request: NQS /seek "+e.duration+"ms"))}catch(e){n.error(e)}},n.managers.View.prototype.sendError=function(e,t){try{this.isErrorSent=!0,!this.infoManager.options.parseCDNNodeHost&&!this.infoManager.options.parseHLS||this.resourceParser.realResource||this.resourceParser.init(),this.infoManager.options.haltOnError&&this.stopTimers(),e=this.infoManager.getErrorParams(e),e.pingTime=void 0!==e.pingTime?e.pingTime:this.comm.pingTime,this.infoManager.options.parseCDNNodeHost&&(e.nodeHost=void 0!==e.nodeHost?e.nodeHost:void 0!==this.resourceParser.nodeHost?this.resourceParser.nodeHost:"",e.nodeType=void 0!==e.nodeType?e.nodeType:void 0!==this.resourceParser.nodeType?this.resourceParser.nodeType:""),this.sendRequest("/error",e,t),n.noticeRequest("Request: NQS /error "+e.msg)}catch(e){n.error(e)}},n.managers.View.prototype.convertBufferToSeek=function(){try{n.noticeRequest("Converting buffer to seek"),this.chrono.seek.startTime=this.chrono.buffer.startTime,this.chrono.seek.lastTime=0,this.chrono.buffer.stop(),this.isBuffering=!1,this.isSeeking=!0}catch(e){n.error(e)}},n.managers.View.monitoringInterval=800,n.managers.View.prototype.jumpNextTick=!1,n.managers.View.prototype.checkPlayhead=function(){if(this.isJoinSent&&!this.isShowingAds){var e=2*n.managers.View.monitoringInterval,t=n.managers.View.monitoringInterval/2,r=1.1*n.managers.View.monitoringInterval,i=this.infoManager.getPlayhead(),s=1e3*Math.abs(this.lastPlayhead-i);if(s<t){var a=this.lastResume?Math.abs((new Date).getTime()-this.lastResume):0;this.enableBufferMonitor&&(0==a||a>n.managers.View.monitoringInterval)&&this.lastPlayhead>0&&!this.isBuffering&&!this.isPaused&&!this.isSeeking&&this.sendBufferStart()}else s>e?this.enableSeekMonitor&&this.lastPlayhead>0&&!this.isSeeking&&(this.isBuffering?this.convertBufferToSeek():this.sendSeekStart()):this.isSeeking&&this.enableSeekMonitor?this.sendSeekEnd():this.isBuffering&&this.enableBufferMonitor&&this.chrono.buffer.getDeltaTime(!1)>r&&this.sendBufferEnd();this.lastPlayhead=i}},n.managers.View.prototype.checkAdPlayhead=function(){if(this.isAdJoinSent){var e=n.managers.View.monitoringInterval/2,t=1.1*n.managers.View.monitoringInterval,r=this.infoManager.getAdPlayhead();1e3*Math.abs(this.lastPlayhead-r)<e?this.enableAdBufferMonitor&&this.lastPlayhead>0&&!this.isAdBuffering&&!this.isAdPaused&&this.sendAdBufferStart():this.isAdBuffering&&this.chrono.adBuffer.getDeltaTime(!1)>t&&this.sendAdBufferEnd(),this.lastPlayhead=r}},n.managers.View.prototype.stopTimers=function(){this.timer.pinger.stop(),this.timer.playheadMonitor.stop(),this.timer.adPlayheadMonitor.stop()},n.managers.View.prototype.sendPing=function(e,t){try{e=this.infoManager.getPingParams(e),this.isShowingAds&&(e=this.infoManager.getAdPingParams(e)),e.pingTime=void 0!==e.pingTime?e.pingTime:this.comm.pingTime,this.isSeeking&&(e.seekDuration=void 0!==e.seekDuration?e.seekDuration:this.chrono.seek.getDeltaTime(!1)),this.isBuffering&&(e.bufferDuration=void 0!==e.bufferDuration?e.bufferDuration:this.chrono.buffer.getDeltaTime(!1)),this.isAdBuffering&&(e.adBufferDuration=void 0!==e.adBufferDuration?e.adBufferDuration:this.chrono.adBuffer.getDeltaTime(!1));var r=this.infoManager.getRendition();if(r&&this.lastRendition!=r&&(this.sendChangedEntity("rendition",r),this.lastRendition=r),1==this.changedEntities.length){var i=this.changedEntities.shift();e.entityType=i.key,e.entityValue=i.value}else if(this.changedEntities.length>1){e.entityType=null,e.entityValue=null,e.entities={};for(var s=0;s<this.changedEntities.length;s++)e.entities[this.changedEntities[s].key]=this.changedEntities[s].value;this.changedEntities=[]}this.sendRequest("/ping",e,t)}catch(e){n.error(e)}},n.managers.View.prototype.sendChangedEntity=function(e,t){try{this.changedEntities.push({key:e,value:t})}catch(e){n.error(e)}},n.utils.Chrono=function(){try{this.startTime=0,this.lastTime=0}catch(e){n.error(e)}},n.utils.Chrono.prototype.getDeltaTime=function(e){try{return this.startTime?0===this.lastTime?!1!==e?this.stop():(new Date).getTime()-this.startTime:this.lastTime-this.startTime:-1}catch(e){n.error(e)}},n.utils.Chrono.prototype.start=function(){try{this.startTime=(new Date).getTime(),this.lastTime=0}catch(e){n.error(e)}},n.utils.Chrono.prototype.stop=function(){try{return this.lastTime=(new Date).getTime(),this.getDeltaTime()}catch(e){n.error(e)}},n.utils.parseNumber=function(e,t){return!isNaN(e)&&e>=0&&e!=1/0&&null!==e&&void 0!==e?e:t},n.utils.listenAllEvents=function(e,t,r){try{if(n.debugLevel>=4){r=r||function(e){var t="";void 0!==e.target&&void 0!==e.target.id&&(t=e.target.id),n.debug("Event: "+t+" > "+e.type)};var i=["canplay","buffering","waiting","ended","play","playing","pause","resume","error","abort","seek","seeking","seeked","stalled","dispose","loadeddata","loadstart"];t&&(null===t[0]?(t.shift(),i=t):i=i.concat(t));for(var s=0;s<i.length;s++)"function"==typeof e?e.call(window,i[s],r):e.on?e.on(i[s],r):e.addEventListener&&e.addEventListener(i[s],r)}}catch(e){n.error(e)}},n.utils.buildRenditionString=function(e,t,r){1==arguments.length&&(r=e,e=null,t=null);var i="";return e&&t&&(i=e+"x"+t,r>0&&(i+="@")),r<1?i:(r<1e3?i+=Math.round(r)+"bps":r<1e6?(r=Math.round(r/1e3),i+=r+"Kbps"):(r=Math.round(r/1e4)/100,i+=r+"Mbps"),i)},n.debugLevel=2,n.messageLevels={1:"e",2:"w",3:"n",4:"d",5:"v"},n.plainConsole=!1,n.report=function(e,t,r){if(console&&console.log){t=t||4,r=r||"darkcyan";var i=n.messageLevels[t],s=n.getCurrentTime()+"[Youbora] "+i+":";if(void 0!==n.remoteLog&&!0===n.remoteLog.enabled&&n.remoteLog(s+e),n.debugLevel>=t)if(n.plainConsole||document.documentMode)n.plainReport(e,s);else{var a=console.log;1==t&&console.error?a=console.error:2==t&&console.warn?a=console.warn:t>=4&&console.debug&&(a=console.debug),s="%c"+s,e instanceof Array?(e.splice(0,0,s,"color: "+r),a.apply(console,e)):a.call(console,s,"color: "+r,e)}}},n.getCurrentTime=function(e){var t=new Date;return"["+("0"+t.getDate()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2)+"."+("00"+t.getMilliseconds()).slice(-3)+"]"},n.plainReport=function(e,t){if(e instanceof Array)for(var r in e)n.plainReport(e[r],t);else"string"==typeof e?console.log(t+" "+e):(console.log(t+" <next line>"),console.log(e))},n.error=function(){n.report([].slice.call(arguments),1,"darkred")},n.warn=function(){n.report([].slice.call(arguments),2,"darkorange")},n.notice=function(){n.report([].slice.call(arguments),3,"darkcyan")},n.noticeRequest=function(){n.report([].slice.call(arguments),3,"darkgreen")},n.debug=function(){n.report([].slice.call(arguments),4,"indigo")},n.verbose=function(){n.report([].slice.call(arguments),5,"navy")},function(){function e(e){switch(e){case"plain":n.plainConsole=!0;break;case"remote":n.remoteLog.forced=!0;break;case"plain+remote":case"remote+plain":n.remoteLog.forced=!0,n.plainConsole=!0}}try{if("undefined"!=typeof window){var t=document.getElementsByTagName("script");for(var r in t)if(t[r].getAttribute){var i=t[r].getAttribute("youbora-debug");i&&(n.debugLevel=i),(i=t[r].getAttribute("youbora-console"))&&e(i)}var s=/\?.*\&*youbora-debug=(.+)/i.exec(window.location.search);null!==s&&(n.debugLevel=s[1]),null!==(s=/\?.*\&*youbora-console=(.+)/i.exec(window.location.search))&&e(s[1])}}catch(e){n.error(e)}}(),n.utils.ResourceParser=function(e){try{this.viewManager=e,this.parseTimeout=null,this.realResource="",this.nodeHost=void 0,this.nodeType=void 0,this.cdn,this.cdnRequests={},this.cdns=n.utils.ResourceParser.cdnsEnabled.slice()}catch(e){n.error(e)}},n.utils.ResourceParser.prototype.init=function(){try{this.realResource&&this.clear(),this.viewManager.comm.addPreloader("ResourceParser");var e=this;this.viewManager.comm.extraOperationsCallback=function(t){void 0!==t.resource&&e.realResource&&(t.resource=e.realResource),void 0!==t.nodeHost&&e.nodeHost&&(t.nodeHost=e.nodeHost,t.nodeType=e.nodeType),!t.cdn&&e.viewManager.infoManager.options.useCDNFromParser&&(t.cdn=e.cdn)},this.parseTimeout=setTimeout(function(){"ResourceParser"in e.viewManager.comm.preloaders&&(e.realResource=e.viewManager.infoManager.getResource(),e.viewManager.comm.removePreloader("ResourceParser"),n.warn("ResourceParser has exceded the maximum execution time (3s) and will be aborted."))},3e3),this.realResource=this.viewManager.infoManager.getResource(),this.viewManager.infoManager.options.parseHLS?this._parseRealResourceAsync(this.realResource):this._parseCDNAsync()}catch(e){n.error(e)}},n.utils.ResourceParser.prototype.clear=function(){this.realResource="",this.nodeHost=void 0,this.nodeType=void 0,this.cdnRequests={},this.cdns=n.utils.ResourceParser.cdnsEnabled.slice()},n.utils.ResourceParser.prototype._parseRealResourceAsync=function(e,t){try{var r=/(\S*?(\.m3u8|\.m3u|\.ts|\.mp4)(\?\S*|\n|\r|$))/i.exec(e);if(null!==r){var i=r[1].trim();if(0!==i.indexOf("http")&&0!==i.indexOf("//")&&(i=t.slice(0,t.lastIndexOf("/"))+"/"+i),".m3u8"==r[2]||".m3u"==r[2]){var s=this;new n.comm.AjaxRequest(i).load(function(){s._parseRealResourceAsync(this.responseText,i)}).error(function(){s._parseCDNAsync()}).send()}else this.realResource=i,this._parseCDNAsync()}else this._parseCDNAsync()}catch(e){n.error(e),this._parseCDNAsync()}},n.utils.ResourceParser.cdnsEnabled=["Level3","Akamai","Highwinds","Fastly"],n.utils.ResourceParser.cdnsAvailable={Level3:{code:"LEVEL3",parsers:[{type:"host+type",name:"X-WR-DIAG",regex:/Host:(.+)\sType:(.+)/}],headers:{"X-WR-DIAG":"host"}},Akamai:{code:"AKAMAI",parsers:[{type:"host+type",name:"X-Cache",regex:/(.+)\sfrom\s.+\(.+\/(.+)\).+/}]},Highwinds:{code:"HIGHNEGR",parsers:[{type:"host+type",name:"X-HW",regex:/.+,[0-9]+\.(.+)\.(.+)/}]},Fastly:{code:"FASTLY",parsers:[{type:"host",name:"X-Served-By",regex:/([^,\s]+)$/},{type:"type",name:"X-Cache",regex:/([^,\s]+)$/}]},Telefonica:{code:"TELEFO",parsers:[{type:"host+type",name:"X-TCDN",regex:/Host:(.+)\sType:(.+)/}]},CustomCDN:{code:null,parsers:[{type:"name",regex:/(.+)/}]}},n.utils.ResourceParser.prototype._parseCDNAsync=function(){try{if(this.viewManager.infoManager.options.parseCDNNodeHost)if(this.cdns.length>0&&!this.nodeHost){var e=this.cdns.shift();if(void 0!==n.utils.ResourceParser.cdnsAvailable[e]){var t=n.utils.ResourceParser.cdnsAvailable[e],r=JSON.stringify(t.headers);if(this.cdnRequests.hasOwnProperty(r))this._parseNode(t,this.cdnRequests[r]);else{var i=this,s=new n.comm.AjaxRequest(this.realResource,"","",{method:"HEAD",maxRetries:0,requestHeaders:t.headers});s.load(function(){i.cdnRequests[r]=s.getXHR(),i._parseNode(t,s.getXHR())}),s.error(function(){i._parseCDNAsync()}),s.send()}}else this._parseCDNAsync()}else this.viewManager.comm.removePreloader("ResourceParser");else this.viewManager.comm.removePreloader("ResourceParser")}catch(e){n.error(e)}},n.utils.ResourceParser.prototype._parseNode=function(e,t){try{var r=e.parsers;for(var i in r){"name"==r[i].type&&(r[i].name=this.viewManager.infoManager.options.parseCDNNameFrom);var s=t.getResponseHeader(r[i].name);if(null===s)return void this._parseCDNAsync();var a=r[i].regex.exec(s);if(null===a)return void this._parseCDNAsync();switch(r[i].type){case"host":this.nodeHost=a[1];break;case"type":this.nodeType=this._parseNodeType(a[1]);break;case"host+type":this.nodeHost=a[1],this.nodeType=this._parseNodeType(a[2]);break;case"type+host":this.nodeType=this._parseNodeType(a[1]),this.nodeHost=a[2];break;case"name":this.cdn=a[1].toUpperCase()}e.code&&(this.cdn=e.code)}this._parseCDNAsync()}catch(e){n.error(e),this._parseCDNAsync()}},n.utils.ResourceParser.prototype._parseNodeType=function(e){try{switch(e){case"TCP_HIT":case"HIT":case"c":return 1;case"TCP_MISS":case"MISS":case"p":case"i":case"m":return 2;case"TCP_MEM_HIT":return 3;case"TCP_IMS_HIT":return 4;default:return 0}}catch(e){return n.error(e),0}},n.utils.Timer=function(e,t){try{this.callback=e,this.interval=t||5e3,this.isRunning=!1,this.timer=null,this.chrono=new n.utils.Chrono}catch(e){n.error(e)}},n.utils.Timer.prototype.start=function(){try{this.isRunning=!0,this._setPing()}catch(e){n.error(e)}},n.utils.Timer.prototype.stop=function(){try{this.isRunning=!1,clearTimeout(this.timer)}catch(e){n.error(e)}},n.utils.Timer.prototype._setPing=function(){try{if(this.isRunning){this.chrono.start();var e=this;this.timer=setTimeout(function(){e.callback(e.chrono.stop()),e._setPing()},this.interval)}}catch(e){n.error(e)}},void 0!==e&&e.exports?e.exports=n:window.$YB=n},function(e,t){e.exports={name:"playkit-js-youbora",version:"0.4.2",main:"dist/playkit-youbora.js",scripts:{clean:"rm -rf ./dist",prebuild:"npm run clean",build:"NODE_ENV=production webpack",dev:"webpack-dev-server",watch:"webpack --progress --colors --watch",test:"NODE_ENV=test karma start --color",release:"standard-version",publish:"git push --follow-tags --no-verify origin master",eslint:"eslint . --color",flow:"flow check","commit:dist":"git add --force --all dist && (git commit -m 'chore: update dist' || exit 0)"},"standard-version":{scripts:{postbump:"yarn run build && npm run commit:dist"}},devDependencies:{"babel-cli":"^6.18.0","babel-core":"^6.18.2","babel-eslint":"^7.1.1","babel-loader":"^6.2.7","babel-plugin-istanbul":"^4.0.0","babel-plugin-transform-class-properties":"^6.22.0","babel-plugin-transform-flow-strip-types":"^6.22.0","babel-preset-es2015":"^6.18.0","babel-register":"^6.23.0",chai:"^3.5.0","cross-env":"^3.1.4","css-loader":"^0.28.4",eslint:"^3.10.0","eslint-loader":"^1.6.1","eslint-plugin-flowtype":"^2.30.0","eslint-plugin-import":"^2.2.0","eslint-plugin-mocha-no-only":"^0.0.5","flow-bin":"latest",istanbul:"^0.4.5",karma:"^1.5.0","karma-chai":"^0.1.0","karma-chrome-launcher":"^2.0.0","karma-cli":"^1.0.1","karma-coverage":"^1.1.1","karma-firefox-launcher":"^1.0.1","karma-ie-launcher":"^1.0.0","karma-mocha":"^1.3.0","karma-safari-launcher":"^1.0.0","karma-sourcemap-loader":"^0.3.7","karma-webpack":"^2.0.2",mocha:"^3.2.0","mocha-cli":"^1.0.1","playkit-js":"https://github.com/kaltura/playkit-js.git#v0.31.2","pre-push":"^0.1.1",sinon:"^2.0.0","sinon-chai":"^2.8.0","standard-version":"^4.2.0","style-loader":"^0.18.2","uglifyjs-webpack-plugin":"^0.4.3",webpack:"latest","webpack-dev-server":"latest"},peerDependencies:{"playkit-js":"https://github.com/kaltura/playkit-js.git#v0.31.2"},keywords:[],license:"AGPL-3.0",repository:{type:"git",url:"git+https://github.com/kaltura/playkit-js-youbora.git"},bugs:{url:"https://github.com/kaltura/playkit-js-youbora/issues"},homepage:"https://github.com/kaltura/playkit-js-youbora#readme"}}])});
//# sourceMappingURL=playkit-youbora.js.map